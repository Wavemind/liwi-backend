<h1>
  <%= t('.title', name: @version.algorithm.name, version: @version.name) %><%= link_to(I18n.t('edit'), edit_algorithm_version_url(@version.algorithm, @version), class: 'btn btn-outline-success ml-3') %>
</h1>
<h4 class="text-warning">
  <%= t('.deployed_version') if @version.is_deployed? %>
</h4>
<div>
  <%= simple_form_for @version, url: generate_variables_algorithm_version_path(@version.algorithm, @version, format: :xlsx), method: :get do |f| %>
    <%= f.submit t('.generate_variables'), class: 'btn btn-primary' %>
  <% end %>
</div>

<p class="display-spaces"><%= @version.description %></p>

<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item">
    <a class="nav-link <%= 'active' if params[:panel].blank? || params[:panel] == 'diagnostics' %>" id="diagnostics-tab" data-toggle="tab" href="#diagnostics" role="tab" aria-controls="diagnostics" aria-selected="false"><%= t('.subtitle_diagnostics') %></a>
  </li>
  <li class="nav-item">
    <a class="nav-link <%= 'active' if params[:panel].present? && params[:panel] == 'final_diagnostics' %>" id="final_diagnostics-tab" data-toggle="tab" href="#final_diagnostics" role="tab" aria-controls="final_diagnostics" aria-selected="false"><%= t('.subtitle_final_diagnoses') %></a>
  </li>
  <li class="nav-item">
    <a class="nav-link <%= 'active' if params[:panel].present? && params[:panel] == 'final_diagnoses_exclusions' %>" id="registration_triage_questions-tab" data-toggle="tab" href="#final_diagnoses_exclusions" role="tab" aria-controls="final_diagnoses_exclusions" aria-selected="false"><%= t('.subtitle_final_diagnoses_exclusions') %> </a>
  </li>
  <% if policy(@version).new? %>
    <li class="nav-item">
      <a class="nav-link <%= 'active' if params[:panel].present? && params[:panel] == 'registration_triage_questions' %>" id="registration_triage_questions-tab" data-toggle="tab" href="#registration_triage_questions" role="tab" aria-controls="registration_triage_questions" aria-selected="false"><%= t('.subtitle_registration_triage_questions') %> </a>
    </li>
    <li class="nav-item">
      <a class="nav-link <%= 'active' if params[:panel].present? && params[:panel] == 'questions_order' %>" id="questions_order-tab" data-toggle="tab" href="#questions_order" role="tab" aria-controls="questions_order" aria-selected="false"><%= t('.subtitle_questions_order') %> </a>
    </li>
    <li class="nav-item">
      <a class="nav-link <%= 'active' if params[:panel].present? && params[:panel] == 'systems_order' %>" id="systems_order-tab" data-toggle="tab" href="#systems_order" role="tab" aria-controls="systems_order" aria-selected="false"><%= t('.subtitle_systems_order') %> </a>
    </li>
    <li class="nav-item">
      <a class="nav-link <%= 'active' if params[:panel].present? && params[:panel] == 'medal_r_config' %>" id="medal_r_config-tab" data-toggle="tab" href="#medal_r_config" role="tab" aria-controls="medal_r_config" aria-selected="false"><%= t('.subtitle_medal_r_config_html') %> </a>
    </li>
    <li class="nav-item">
      <a class="nav-link <%= 'active' if params[:panel].present? && params[:panel] == 'medal_data_config' %>" id="medal_data_config-tab" data-toggle="tab" href="#medal_data_config" role="tab" aria-controls="medal_data_config" aria-selected="false"><%= t('.subtitle_medal_data_config_html') %> </a>
    </li>
  <% end %>
  <li class="nav-item">
    <a class="nav-link <%= 'active' if params[:panel].present? && params[:panel] == 'triage_conditions' %>" id="triage_conditions-tab" data-toggle="tab" href="#triage_conditions" role="tab" aria-controls="triage_conditions" aria-selected="false"><%= t('.subtitle_triage_conditions') %> </a>
  </li>
  <li class="nav-item">
    <a class="nav-link <%= 'active' if params[:panel].present? && params[:panel] == 'translations' %>" id="translations-tab" data-toggle="tab" href="#translations" role="tab" aria-controls="translations" aria-selected="false"><%= t('.subtitle_translations') %> </a>
  </li>
</ul>

<div class="tab-content mt-4 ml-4" id="version-table">
  <div class="tab-pane fade <%= 'show active' if params[:panel].blank? || params[:panel] == 'diagnostics' %>" id="diagnostics" role="tabpanel" aria-labelledby="diagnostics-tab">
    <h2><%= t('.subtitle_diagnostics') %></h2>
    <%= link_to new_algorithm_version_diagnostic_url(@algorithm, @version) do %>
      <button type="button" class="btn btn-outline-primary"><%= t('add') %></button>
    <% end %>

    <%= render 'diagnostics/table' %>
  </div>

  <div class="tab-pane fade <%= 'show active' if params[:panel].present? && params[:panel] == 'final_diagnostics' %>" id="final_diagnostics" role="tabpanel" aria-labelledby="questions-tab">
    <h3><%= t('.subtitle_final_diagnoses') %></h3>

    <%= render 'final_diagnostics/table_for_version' %>
  </div>

  <div class="tab-pane fade <%= 'show active' if params[:panel].present? && params[:panel] == 'final_diagnoses_exclusions' %>" id="final_diagnoses_exclusions" role="tabpanel" aria-labelledby="final_diagnoses_exclusions-tab">

    <h2><%= t('.subtitle_final_diagnoses_exclusions') %></h2>

    <%= simple_form_for NodeExclusion.new, url: add_exclusion_algorithm_version_final_diagnostics_url(@version.algorithm, @version, format: :html), method: :post do |f| %>
      <div class="row">
        <div class="col">
          <%= f.input :excluding_node_id, collection: @version.diagnostics.map(&:final_diagnostics).flatten, value_method: :id, label_method: :reference_label, label: false, prompt: t('prompt') %>
        </div>
        <div class="col text-center">
          <%= t('.excludes') %>
        </div>
        <div class="col">
          <%= f.input :excluded_node_id, collection: @version.diagnostics.map(&:final_diagnostics).flatten, value_method: :id, label_method: :reference_label, label: false, prompt: t('prompt') %>
        </div>
        <div class="col text-right">
          <%= f.submit t('add'), class: 'btn btn-primary' %>
        </div>
      </div>
    <% end %>

    <%= render 'final_diagnosis_exclusion/table' %>
  </div>

  <% if policy(@version).new? %>
    <div class="tab-pane fade <%= 'show active' if params[:panel].present? && params[:panel] == 'registration_triage_questions' %>" id="registration_triage_questions" data-url=<%= change_triage_order_algorithm_version_url(@algorithm, @version) %> role="tabpanel" aria-labelledby="registration_triage_questions-tab">
      <%= render 'registration_triage_questions' %>
    </div>

    <div class="tab-pane fade ordering-tab <%= 'show active' if params[:panel].present? && params[:panel] == 'questions_order' %>" id="questions_order" data-url=<%= change_triage_order_algorithm_version_url(@algorithm, @version) %> role="tabpanel" aria-labelledby="questions_order-tab">
      <%= render 'triage_order' %>
    </div>

    <div class="tab-pane fade ordering-tab <%= 'show active' if params[:panel].present? && params[:panel] == 'systems_order' %>" id="systems_order" data-url=<%= change_systems_order_algorithm_version_url(@algorithm, @version) %> role="tabpanel" aria-labelledby="systems_order-tab">
      <%= render 'systems_order' %>
    </div>

    <div class="tab-pane fade <%= 'show active' if params[:panel].present? && params[:panel] == 'medal_r_config' %>" id="medal_r_config" data-url=<%= change_triage_order_algorithm_version_url(@algorithm, @version) %> role="tabpanel" aria-labelledby="medal_r_config-tab">
      <%= render 'medal_r_config' %>
    </div>

    <div class="tab-pane fade <%= 'show active' if params[:panel].present? && params[:panel] == 'medal_data_config' %>" id="medal_data_config" data-url=<%= change_triage_order_algorithm_version_url(@algorithm, @version) %> role="tabpanel" aria-labelledby="medal_r_config-tab">
      <%= render 'medal_data_config' %>
    </div>
  <% end %>

  <div class="tab-pane fade <%= 'show active' if params[:panel].present? && params[:panel] == 'triage_conditions' %>" id="triage_conditions" role="tabpanel" aria-labelledby="triage_conditions-tab">
    <%= render 'triage_conditions' %>
  </div>

  <div class="tab-pane fade <%= 'show active' if params[:panel].present? && params[:panel] == 'translations' %>" id="translations" role="tabpanel" aria-labelledby="translations-tab">
    <%= render 'translations' %>
  </div>
</div>
